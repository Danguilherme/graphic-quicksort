"use strict";function quicksort(a){if(0==a.length)return[];for(var b=[],c=[],d=a[0],e=1;e<a.length;e++)a[e]<d?b.push(a[e]):c.push(a[e]);return quicksort(b).concat(d,quicksort(c))}function quicksortMetadata(a,b){if(0==a.length)return null;var c=[],d=[],e=a[0];b=b||new Node(a),b.pivot=e;for(var f=1;f<a.length;f++)a[f]<e?c.push(a[f]):d.push(a[f]);return b.left=quicksortMetadata(c),b.right=quicksortMetadata(d),b}function node2tree(a,b,c){var d={parent:c||null,collection:a.collection,pivot:a.pivot,children:[],side:b||null};return a.left&&d.children.push(node2tree(a.left,"left",d)),a.right&&d.children.push(node2tree(a.right,"right",d)),d}function Node(a){this.collection=a,this.left=null,this.right=null,this.pivot=null}$(function(){function a(a){var b=d3.layout.tree().size([f,e]),c=(d3.svg.diagonal().projection(function(a){return[a.x,a.y]}),b.nodes(a).reverse()),d=b.links(c);c.forEach(function(a){a.y=120*a.depth});var j=h.selectAll("g.node").data(c,function(a){return a.id||(a.id=++i)}),k=500,l=j.enter().append("g").attr("class",function(a){var b="node";return a.children&&a.children.length||(b+=" no-child"),b}).attr("transform",function(a){return"translate("+a.x+","+a.y+")"});l.append("ellipse").attr("rx",function(a){return Math.max(5*a.collection.toString().length,20)}).attr("ry",function(){return Math.min(d3.select(this).attr("rx"),30)}),l.append("text").attr("dy",".35em").attr("text-anchor","middle").style("fill-opacity",1).text(function(a){return a.collection.join(", ")}),j.exit().transition().duration(k).style("opacity",0).remove();var m=l.append("g").attr("class","pivot").attr("title","Pivot").attr("transform",function(){return"translate(0, "+d3.select(this.parentNode.firstChild).attr("ry")+")"});m.append("rect").attr("height",25).attr("width",function(a){return Math.max(10*a.pivot.toString().length+10,20)}).attr("transform",function(){return"translate(-"+d3.select(this).attr("width")/2+",-5)"}),m.append("text").attr("dy",13).attr("text-anchor","middle").style("fill-opacity",1).text(function(a){return a.pivot});var n=h.selectAll("g.link").data(d,function(a){return a.target.id}),o=n.enter().insert("g","g.node").attr("class","link");o.append("line").attr("class","link").attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}),o.append("text").attr("x",function(a){return(a.source.x+a.target.x)/2}).attr("y",function(a){return(a.source.y+a.target.y)/2}).attr("dy",20).attr("text-anchor","middle").style("fill-opacity",1).attr("title",function(a){return("left"==a.target.side?"Items less than ":"Items greater than ")+a.source.pivot}).text(function(a){return"left"==a.target.side?"<":">"}),n.exit().transition().duration(k).style("opacity",0).remove(),g.attr("height",150*d3.max(c,function(a){return a.depth}))}function b(b){console.log("Drawing quicksort for collection",b);var c=quicksortMetadata(b),d=quicksort(b),e=node2tree(c);console.log("sorted:",d),console.log("metadata:",c),console.log("treefy:",e),a(e)}function c(a){var c,d=$(a).val();if(-1!=d.search(",")){c=d.split(",");for(var e=0;e<c.length;e++)c[e]=parseFloat(c[e])}else c=d.split("");b(c)}var d={top:120,right:20,bottom:120,left:20},e=960-d.right-d.left,f=1024-d.top-d.bottom,g=d3.select("#drawing-root").append("svg").attr("width",e+d.right+d.left).attr("height",f+d.top+d.bottom),h=g.append("g").attr("transform","translate("+d.left+","+d.top+")"),i=0;$("#collection-input").change(function(){c(this)}).change().tokenfield()});