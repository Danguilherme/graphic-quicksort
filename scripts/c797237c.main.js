"use strict";function quicksort(a){if(0===a.length)return[];for(var b=[],c=[],d=a[0],e=1;e<a.length;e++)a[e]<d?b.push(a[e]):c.push(a[e]);return quicksort(b).concat(d,quicksort(c))}function quicksortMetadata(a,b,c){if(0===b.length)return null;a=a||{pivot:"middle"};var d;"start"===a.pivot?d=0:"middle"===a.pivot?d=parseInt(b.length/2):"end"===a.pivot&&(d=b.length-1);var e=[],f=[],g=b[d];c=c||new Node(b),c.pivot=g;for(var h=1;h<b.length;h++)b[h]<g?e.push(b[h]):f.push(b[h]);return c.left=quicksortMetadata(a,e),c.right=quicksortMetadata(a,f),c}function node2tree(a,b,c){if(!a)return null;var d={parent:c||null,collection:a.collection,pivot:a.pivot,children:[],side:b||null};return a.left&&d.children.push(node2tree(a.left,"left",d)),a.right&&d.children.push(node2tree(a.right,"right",d)),d}function Node(a){this.collection=a,this.left=null,this.right=null,this.pivot=null}$(function(){function a(a){var b=j.nodes(a).reverse(),c=j.links(b);b.forEach(function(a){a.y=120*a.depth});var d=i.selectAll("g.node").data(b,function(a){return a.id||(a.id=++k)}),f=d.enter().append("g").attr("class",function(a){var b="node";return a.children&&a.children.length||(b+=" no-child"),b}).attr("transform",function(a){return"translate("+a.x+","+a.y+")"});f.append("ellipse").attr("rx",function(a){return Math.max(5*a.collection.toString().length,20)}).attr("ry",function(){return Math.min(d3.select(this).attr("rx"),30)}),f.append("text").attr("dy",".35em").attr("text-anchor","middle").style("fill-opacity",1).text(function(a){return a.collection.join(", ")}),d.exit().transition().style("opacity",0).remove();var g=f.append("g").attr("class","pivot").attr("title","Pivot").attr("transform",function(){return"translate(0, "+d3.select(this.parentNode.firstChild).attr("ry")+")"});g.append("rect").attr("height",25).attr("width",function(a){return Math.max(10*a.pivot.toString().length+10,20)}).attr("transform",function(){return"translate(-"+d3.select(this).attr("width")/2+",-5)"}),g.append("text").attr("dy",13).attr("text-anchor","middle").style("fill-opacity",1).text(function(a){return a.pivot});var l=i.selectAll("g.link").data(c,function(a){return a.target.id}),m=l.enter().insert("g","g.node").attr("class","link");m.append("line").attr("class","link").attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}),m.append("text").attr("x",function(a){return(a.source.x+a.target.x)/2}).attr("y",function(a){return(a.source.y+a.target.y)/2}).attr("dy",20).attr("text-anchor","middle").style("fill-opacity",1).attr("title",function(a){return"Items "+("left"===a.target.side?"less":"greater")+" than "+a.source.pivot}).text(function(a){return"left"===a.target.side?"<":">"}),l.exit().transition().style("opacity",0).remove();var n=d3.max(b,function(a){return a.depth})+1;h.attr("height",120*n+(e.top+e.bottom))}function b(a,b){var c=quicksort(b),d=quicksortMetadata(a,b),e=node2tree(d),f=j.nodes(e).reverse(),g=d3.max(f,function(a){return a.depth})+1;console.log("sorted:",c),console.log("metadata:",d),console.log("treefy:",e),$("#original-collection").text(b.join(", ")),$("#sorted-collection").text(c.join(", ")),$("#depths").text(g)}function c(c,d){console.log("Drawing quicksort for collection",d);var e=quicksortMetadata(c,d),f=node2tree(e);a(f),b(c,d)}function d(){var a,b=$('[name="pivot-position"]:radio:checked'),d=$("#collection-input"),e=d.val(),f={};if(f.pivot=b.val(),-1!==e.search(",")){a=e.split(",");for(var g=0;g<a.length;g++)a[g]=parseFloat(a[g])}else a=e.split("");return a&&a.length?($("#sort-visualization").removeClass("hidden"),void c(f,a)):void $("#sort-visualization").addClass("hidden")}var e={top:60,right:20,bottom:60,left:20},f=960-e.right-e.left,g=1024-e.top-e.bottom,h=d3.select("#drawing-target").append("svg").attr("width",f+e.right+e.left).attr("height",g+e.top+e.bottom),i=h.append("g").attr("transform","translate("+e.left+","+e.top+")"),j=d3.layout.tree().size([g,f]),k=(d3.svg.diagonal().projection(function(a){return[a.x,a.y]}),0);$('[name="pivot-position"]:radio').change(d),$("#collection-input").change(d).change().tokenfield()});